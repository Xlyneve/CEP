<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minimal Chat with Full Features</title>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minimal Chat with Full Features</title>
<style>
@font-face {
  font-family: 'fors';
  src: url('fors.ttf') format('truetype');
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'fors', sans-serif, Arial, sans-serif;
  background-color: #fefefe;
  color: #222;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#chat {
  flex-grow: 1;
  width: 100%;
  padding: 20px 5vw 160px 5vw;
  overflow-y: auto;
  font-size: 15px;
  background-color: #fefefe;
  box-sizing: border-box;
}

.message {
  margin-bottom: 8px;
  line-height: 1.6;
  font-size: 15px;
  white-space: pre-wrap;
  word-wrap: break-word;
  word-break: break-word;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.message.user {
  align-items: flex-end;
}

.message.bot {
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  padding-top: 12px;
  margin-top: 12px;
}

.user, .bot {
  background: none;
  color: #222;
}

.editableNote {
  white-space: pre-wrap;
  background: none;
  color: #222;
  padding: 4px;
  border: none;
  font-family: 'fors', sans-serif;
  font-size: 15px;
  outline: none;
}

#inputArea {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  width: 90vw;
  max-width: 600px;
  gap: 10px;
  background: #f0f0f0;
  padding: 12px 20px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(100, 100, 100, 0.1);
  z-index: 100;
  box-sizing: border-box;
}

#noteInput {
  min-height: 60px;
  max-height: 400px;
  overflow-y: auto;
  font-size: 13px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #f9f9f9;
  color: #222;
  outline: none;
  white-space: pre-wrap;
}

#noteInput:empty:before {
  content: attr(data-placeholder);
  color: #aaa;
  pointer-events: none;
  display: block;
}

#userInput {
  flex-grow: 1;
  font-size: 13px;
  padding: 10px 16px;
  border-radius: 12px;
  border: 1px solid #ddd;
  background: #f9f9f9;
  color: #3a3a3a;
  outline: none;
}

#userInput:focus {
  border-color: #999;
  box-shadow: 0 0 6px rgba(100, 100, 100, 0.4);
}

#sendBtn {
  display: none;
}

#emojiColumn {
  position: fixed;
  top: 10px;
  left: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 101;
}

.emoji, .format-btn {
  background: none;
  color: #444;
  border: none;
  cursor: pointer;
  opacity: 0.7;
  font-size: 16px;
  transition: all 0.2s ease;
}

.emoji:hover, .format-btn:hover {
  transform: scale(1.2);
  opacity: 1;
}

#noteContainer {
  position: fixed;
  bottom: 40px;
  right: 20px;
  width: 50px;
  height: 50px;
  z-index: 103;
}

#addNoteToggle {
  width: 50px;
  height: 50px;
  font-size: 28px;
  border-radius: 50%;
  background: #fddde6;
  color: #333;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

#notePanel {
  position: absolute;
  bottom: 60px;
  right: 0;
  width: 300px;
  background: #fefefe;
  color: #222;
  border-radius: 12px;
  padding: 16px;
  display: none;
  flex-direction: column;
  gap: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 104;
}

#addNoteBtn {
  background: #fbd4d4;
  color: #3a3a3a;
  border: none;
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
}

.note-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 16px;
  color: #555;
  margin-right: 8px;
}

.message img {
  max-width: 100%;
  margin-top: 6px;
  border-radius: 8px;
}

.divider {
  height: 12px;
}

#authToggle {
  position: fixed;
  top: 12px;
  right: 12px;
  background: #fddde6;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 20px;
  text-align: center;
  line-height: 40px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  z-index: 200;
}

/* Auth section (login, logout, user info) */
#authSection {
  position: fixed;
  top: 60px;
  right: 12px;
  display: none;
  flex-direction: column;
  align-items: flex-end;
  background: rgba(255, 255, 255, 0.95);
  padding: 10px 12px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  gap: 8px;
  z-index: 199;
}

#authSection input {
  background: #f2f2f2;
  color: #333;
  border: 1px solid #ccc;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 10px;
}

#authSection button {
  background: #fddde6;
  color: black;
  border: none;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 10px;
}

#logoutBtn:hover,
#loginBtn:hover {
  background: #fbb6c2;
}

#userInfo {
  color: #555;
  font-weight: 500;
}

/* Highlight underline animation */
.highlighted {
  position: relative;
  font-weight: 500;
  color: #222;
}

.highlighted::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  border-bottom: 1px dotted #888;
  animation: underlineFade 1.2s ease-in-out infinite alternate;
}

@keyframes underlineFade {
  from { opacity: 0.2; }
  to { opacity: 1; }
}

/* Note cards - moved outside media query for visibility on all screen sizes */
.noteCard {
  position: relative;
  background: #fff;
  border-radius: 12px;
  padding: 14px 18px;
  margin: 10px 0;
  box-shadow: 0 1.5px 5px rgba(0, 0, 0, 0.08);
  animation: slideFade 0.35s ease-out;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  font-size: 15px;
  color: #222;
}

.noteCard:hover {
  box-shadow: 0 5px 18px rgba(0, 0, 0, 0.12);
  transform: translateY(-3px);
}

.noteCard::before {
  content: '';
  display: block;
  width: 6px;
  height: 100%;
  background: #fbd4d4; /* pastel pink accent */
  position: absolute;
  left: 0;
  top: 0;
  border-radius: 12px 0 0 12px;
}

@keyframes slideFade {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.note-btn {
  font-size: 14px;
  opacity: 0.6;
  background: none;
  border: none;
  margin-top: 8px;
  cursor: pointer;
  transition: opacity 0.2s ease;
  color: #555;
  padding: 0 6px;
}

.note-btn:hover {
  opacity: 1;
  color: #333;
}

/* Responsive adjustments */
@media (max-width: 600px) {
  #chat {
    padding: 12px 4vw 160px 4vw;
  }

  #inputArea {
    width: 95vw;
    bottom: 30px;
  }

  #notePanel {
    width: 90vw;
    right: 5vw;
  }

  #authSection {
    flex-direction: column;
    align-items: flex-end;
    gap: 6px;
    top: 10px;
    right: 10px;
  }

  .chatBubble {
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }
}


</style>
</head>
<body>

<div id="authToggle">üë©‚Äçüíª</div>

<div id="authSection">
  <input type="email" id="email" placeholder="Email" autocomplete="username" />
  <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
  <button id="loginBtn">Log In</button>
  <button id="logoutBtn" style="display:none;" title="Log Out">üö™</button>
  <div id="userInfo">Not logged in</div>
</div>


<div id="emojiColumn">
  <button class="format-btn" id="boldBtn">üÖ±Ô∏è</button>
  <button class="format-btn" id="highlightBtn">üí°</button>
  <button class="format-btn" id="resetColorBtn">üîÑ</button>
  <div class="divider"></div>
  <div class="emoji" data-emoji="üìå">üìå</div>
  <div class="emoji" data-emoji="üü°">üü°</div>
  <div class="emoji" data-emoji="üî¥">üî¥</div>
  <div class="emoji" data-emoji="üî∏">üî∏</div>
  <div class="emoji" data-emoji="‚ñ∂">‚ñ∂</div>
</div>

<!-- Container for add button and note panel -->
<div id="noteContainer">
  <button id="addNoteToggle" title="Add Note">Ôºã</button>
  <div id="notePanel">
    <div id="noteInput" contenteditable="true" data-placeholder="Type or paste your note here..."></div>
    <button id="addNoteBtn">Add Note</button>
  </div>
</div>

<div id="chat"></div>

<form id="inputArea">
  <input type="text" id="userInput" placeholder="Type here..." autocomplete="off" required />
  <button type="submit" id="sendBtn">Send</button>
</form>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDtv3x9PAMzZUW6yVuUSLgLzA0ejcDidF4",
    authDomain: "notes-chat-c5ff3.firebaseapp.com",
    projectId: "notes-chat-c5ff3",
    storageBucket: "notes-chat-c5ff3.appspot.com",
    messagingSenderId: "597780727252",
    appId: "1:597780727252:web:8407eb4096dbe301d74241",
    measurementId: "G-YQD63H7L5T"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const chat = document.getElementById('chat');
  const userInput = document.getElementById('userInput');
  const inputArea = document.getElementById('inputArea');
  const noteInput = document.getElementById('noteInput');
  const addNoteBtn = document.getElementById('addNoteBtn');
  const addNoteToggle = document.getElementById('addNoteToggle');
  const notePanel = document.getElementById('notePanel');

  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const userInfo = document.getElementById('userInfo');

  // Show/hide note panel & addNoteToggle only when logged in
  function updateUIForUser(user) {
    if (user) {
      userInfo.textContent = 'Logged in as ' + user.email;
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'block';
      emailInput.style.display = 'none';
      passwordInput.style.display = 'none';
      addNoteToggle.style.display = 'inline-block';
      notePanel.style.display = 'none'; // Hidden until toggle clicked
    } else {
      userInfo.textContent = 'Not logged in';
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      emailInput.style.display = 'inline-block';
      passwordInput.style.display = 'inline-block';
      addNoteToggle.style.display = 'none';
      notePanel.style.display = 'none';
    }
  }

  auth.onAuthStateChanged(user => {
    updateUIForUser(user);
  });

  loginBtn.onclick = async () => {
    try {
      await auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value);
    } catch (err) {
      alert('Login failed: ' + err.message);
    }
  };

  logoutBtn.onclick = () => auth.signOut();

  addNoteToggle.onclick = () => {
    if (notePanel.style.display === 'flex') {
      notePanel.style.display = 'none';
    } else {
      notePanel.style.display = 'flex';
      noteInput.focus();
    }
  };

  function addMessage(sender, text) {
  const div = document.createElement('div');
  div.className = 'message ' + sender;

  const bubble = document.createElement('div');
  bubble.className = 'chatBubble';

  bubble.style.padding = '10px 14px';
  bubble.style.borderRadius = '16px';
  bubble.style.margin = '4px 0';
  bubble.style.maxWidth = '80%';
  bubble.style.whiteSpace = 'pre-wrap';
  bubble.style.wordWrap = 'break-word';
  bubble.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
  bubble.style.transition = 'transform 0.15s ease, box-shadow 0.2s ease';

  bubble.onmouseover = () => {
    bubble.style.transform = 'scale(1.02)';
    bubble.style.boxShadow = '0 4px 8px rgba(0,0,0,0.08)';
  };
  bubble.onmouseout = () => {
    bubble.style.transform = 'scale(1)';
    bubble.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
  };

  if (sender === 'user') {
    bubble.innerHTML = 'üß† ' + text;
    bubble.style.background = '#eae6f8'; // pastel lavender
    bubble.style.color = '#3e3a5e';
    bubble.style.alignSelf = 'flex-end';
  } else {
    bubble.innerHTML = 'ü§ñ ' + text;
    bubble.style.background = '#f3f3f3'; // pastel gray
    bubble.style.color = '#333333';
    bubble.style.alignSelf = 'flex-start';
  }

  div.appendChild(bubble);
  chat.appendChild(div);
  chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
}


  addNoteBtn.onclick = async () => {
    const user = auth.currentUser;
    if (!user) {
      alert('Please log in to add notes.');
      return;
    }
    const noteText = noteInput.innerHTML.trim();
    if (!noteText) return alert("Please enter a note.");

    addNoteBtn.disabled = true;
    addNoteBtn.textContent = "Adding...";

    try {
      await db.collection('notes').add({
        content: noteText,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        uid: user.uid
      });
      addMessage('bot', '‚úÖ Note added!');
      noteInput.innerHTML = '';
      notePanel.style.display = 'none';
    } catch (e) {
      alert('Error: ' + e.message);
    } finally {
      addNoteBtn.disabled = false;
      addNoteBtn.textContent = "Add Note";
    }
  };

  async function queryNotes(question) {
    const snapshot = await db.collection('notes').orderBy('createdAt', 'desc').get();
    return snapshot.docs
      .filter(doc => doc.data().content.toLowerCase().includes(question.toLowerCase()))
      .map(doc => ({ ...doc.data(), id: doc.id }));
  }

  function displayNotes(notes, query = '') {
    // Do NOT clear chat.innerHTML here to keep conversation

    if (notes.length === 0) {
      addMessage('bot', '‚ùå No matching notes found.');
      return;
    }

    const highlightText = (html, keyword) => {
      if (!keyword) return html;

      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;

      const walk = node => {
        if (node.nodeType === 3) {
          const text = node.nodeValue;
          const escaped = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const regex = new RegExp(`(${escaped})`, 'gi');
          const parts = text.split(regex);

          if (parts.length > 1) {
            const frag = document.createDocumentFragment();
            parts.forEach(part => {
              if (part.toLowerCase() === keyword.toLowerCase()) {
                const span = document.createElement('span');
                span.className = 'highlighted';
                span.textContent = part;
                frag.appendChild(span);
              } else {
                frag.appendChild(document.createTextNode(part));
              }
            });
            node.replaceWith(frag);
          }
        } else if (node.nodeType === 1 && node.childNodes) {
          [...node.childNodes].forEach(walk);
        }
      };

      [...tempDiv.childNodes].forEach(walk);
      return tempDiv.innerHTML;
    };

    // Optional separator between results and old messages
    const separator = document.createElement('hr');
    separator.style.border = 'none';
    separator.style.borderTop = '1px solid #ccc';
    separator.style.margin = '12px 0';
    chat.appendChild(separator);

    notes.forEach(({ content, id }, index) => {
  const div = document.createElement('div');
  div.className = 'message bot noteCard'; // noteCard for styling & animation
  if (index > 0) div.style.borderTop = '1px solid rgba(255, 255, 255, 0.1)';

  const noteText = document.createElement('div');
  noteText.className = 'editableNote';
  noteText.contentEditable = false;
  noteText.innerHTML = highlightText(content, query);  // no emoji prefix
  div.appendChild(noteText);

  const btns = document.createElement('div');
  const editBtn = document.createElement('button');
  editBtn.className = 'note-btn';
  editBtn.textContent = '‚úèÔ∏è';
  const deleteBtn = document.createElement('button');
  deleteBtn.className = 'note-btn';
  deleteBtn.textContent = 'üóëÔ∏è';
  btns.append(editBtn, deleteBtn);
  div.appendChild(btns);

  let editing = false;
  editBtn.onclick = () => {
    if (!editing) {
      editing = true;
      noteText.contentEditable = true;
      noteText.focus();
      editBtn.textContent = '‚úÖ';
    } else {
      const updated = noteText.innerHTML.trim();
      if (!updated) return alert("Cannot be empty");
      db.collection('notes').doc(id).update({ content: updated });
      noteText.contentEditable = false;
      editBtn.textContent = '‚úèÔ∏è';
      editing = false;
    }
  };

  deleteBtn.onclick = () => {
    if (confirm("Delete this note?")) {
      db.collection('notes').doc(id).delete();
      chat.removeChild(div);
    }
  };

  chat.appendChild(div);
});


    // Scroll to bottom so latest notes are visible
    chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
  }

  inputArea.onsubmit = async (e) => {
    e.preventDefault();
    const question = userInput.value.trim();
    if (!question) return;

    // Show user message in chat
    addMessage('user', question);

    userInput.value = '';

    // Show temporary loading bot message
    const loadingBubble = document.createElement('div');
    loadingBubble.className = 'message bot';
    loadingBubble.textContent = 'ü§ñ ‚è≥ Searching...';
    chat.appendChild(loadingBubble);
    chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });

    const results = await queryNotes(question);

    // Remove loading message
    chat.removeChild(loadingBubble);

    // Show results
    displayNotes(results, question);
  };

  // Emojis and formatting buttons
  document.querySelectorAll('.emoji').forEach(btn => {
    btn.onclick = () => {
      navigator.clipboard.writeText(btn.dataset.emoji);
      btn.style.transform = 'scale(1.3)';
      setTimeout(() => (btn.style.transform = 'scale(1)'), 200);
    };
  });
  
  document.getElementById('authToggle').onclick = () => {
  const section = document.getElementById('authSection');
  section.style.display = section.style.display === 'flex' ? 'none' : 'flex';
};


  document.getElementById('boldBtn').onclick = () => {
    document.execCommand('bold');
  };

  document.getElementById('highlightBtn').onclick = () => {
    document.execCommand('foreColor', false, '#5c6ac4'); 
  };

  document.getElementById('resetColorBtn').onclick = () => {
    document.execCommand('foreColor', false, 'black');
  };

  addMessage('bot', 'üëã Welcome X! Please log in to add or manage notes.');
  
</script>


</body>
</html>
