<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minimal Chat with Full Features</title>
<style>
  @font-face {
    font-family: 'fors';
    src: url('fors.ttf') format('truetype');
  }

  html, body {
    height: 100%;
    margin: 0; padding: 0;
    font-family: 'fors', sans-serif, Arial, sans-serif;
    background-color: #121212;
    color: white;
    display: flex;
    flex-direction: column;
  }

  #chat {
    flex-grow: 1;
    width: 95vw;
    margin: 10px auto 140px auto;
    padding: 20px;
	padding-left: 100px;
    overflow-y: auto;
    font-size: 15px;
  }

  .message {
    margin-bottom: 8px;
    line-height: 1.6;
    font-size: 15px;
    white-space: pre-wrap;
    word-wrap: break-word;
	word-break: break-word;

  }
  .message.bot {
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding-top: 12px;
  margin-top: 12px;
}

  .user, .bot {
    background: none;
    color: white;
  }

  .editableNote {
    white-space: pre-wrap;
    background: none;
    color: white;
    padding: 4px;
    border: none;
    font-family: 'fors', sans-serif;
    font-size: 15px;
    outline: none;
  }

  #inputArea {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    width: 90vw;
    max-width: 600px;
    gap: 10px;
    background: #1e1e1e;
    padding: 12px 20px;
    border-radius: 12px;
     box-shadow:
    0 0 8px rgba(218, 181, 217, 0.6),
    0 0 16px rgba(218, 181, 217, 0.3);
    z-index: 100;
  }
  #noteInput {
  min-height: 60px;
  max-height: 400px;
  overflow-y: auto;
  font-size: 13px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #222;
  color: white;
  outline: none;
  white-space: pre-wrap;
}

#noteInput:empty:before {
  content: attr(data-placeholder);
  color: #777;
  pointer-events: none;
  display: block;
}


  #userInput {
    flex-grow: 1;
    font-size: 13px;
    padding: 10px 16px;
    border-radius: 12px;
    border: 1px solid #444;
    background: #222;
    color: white;
    outline: none;
  }

  #userInput:focus {
    border-color: #888;
    box-shadow: 0 0 6px rgba(169, 142, 170, 0.7);
  }

  #sendBtn {
    display: none;
  }

  #emojiColumn {
    position: fixed;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 101;
  }

  .emoji, .format-btn {
    background: none;
    color: white;
    border: none;
    cursor: pointer;
    opacity: 0.7;
    font-size: 16px;
    transition: all 0.2s ease;
  }

  .emoji:hover, .format-btn:hover {
    transform: scale(1.2);
    opacity: 1;
  }

  #notePanel {
    position: fixed;
    top: 60px;
    right: 16px;
    width: 300px;
    background: transparent;
    color: white;
    border-radius: 12px;
    padding: 16px;
    display: none;
    flex-direction: column;
    gap: 12px;
    z-index: 102;
  }

  #noteInput, #imageInput {
    width: 100%;
    font-size: 13px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #444;
    background: #222;
    color: white;
  }

  #addNoteBtn {
    background: #333;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  #addNoteToggle {
    position: fixed;
    top: 12px;
    right: 12px;
    background: #dab5d9;
    color: black;
    font-size: 24px;
    font-weight: bold;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    z-index: 103;
  }

  .note-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    color: white;
    margin-right: 8px;
  }

  .message img {
    max-width: 100%;
    margin-top: 6px;
    border-radius: 8px;
  }
  .divider {
  height: 12px;
}

</style>
</head>
<body>

<div id="emojiColumn">
  <button class="format-btn" id="boldBtn">üÖ±Ô∏è</button>
  <button class="format-btn" id="highlightBtn">üí°</button>
  <button class="format-btn" id="resetColorBtn">üîÑ</button>
  
    <div class="divider"></div>
	
  <div class="emoji" data-emoji="üìå">üìå</div>
  <div class="emoji" data-emoji="üü°">üü°</div>
  <div class="emoji" data-emoji="üî¥">üî¥</div>
  <div class="emoji" data-emoji="üî∏">üî∏</div>
  <div class="emoji" data-emoji="‚ñ∂">‚ñ∂</div>
</div>

<button id="addNoteToggle" title="Add Note">Ôºã</button>

<div id="notePanel">
  <div id="noteInput" contenteditable="true" data-placeholder="Type or paste your note here..."></div>
  <input type="file" id="imageInput" accept="image/*" />
  <button id="addNoteBtn">Add Note</button>
</div>

<div id="chat"></div>

<form id="inputArea">
  <input type="text" id="userInput" placeholder="Type here..." autocomplete="off" required />
  <button type="submit" id="sendBtn">Send</button>
</form>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDtv3x9PAMzZUW6yVuUSLgLzA0ejcDidF4",
    authDomain: "notes-chat-c5ff3.firebaseapp.com",
    projectId: "notes-chat-c5ff3",
    storageBucket: "notes-chat-c5ff3.appspot.com",
    messagingSenderId: "597780727252",
    appId: "1:597780727252:web:8407eb4096dbe301d74241",
    measurementId: "G-YQD63H7L5T"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const chat = document.getElementById('chat');
  const userInput = document.getElementById('userInput');
  const inputArea = document.getElementById('inputArea');
  const noteInput = document.getElementById('noteInput');
  const imageInput = document.getElementById('imageInput');
  const addNoteBtn = document.getElementById('addNoteBtn');
  const addNoteToggle = document.getElementById('addNoteToggle');
  const notePanel = document.getElementById('notePanel');

  function addMessage(sender, text, imageUrl = null) {
    const div = document.createElement('div');
    div.className = 'message ' + sender;
    div.textContent = (sender === 'user' ? 'üßë ' : 'ü§ñ ') + text;
    if (imageUrl) {
      const img = document.createElement('img');
      img.src = imageUrl;
      div.appendChild(img);
    }
    chat.appendChild(div);
    chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
  }

  addNoteToggle.onclick = () => {
    notePanel.style.display = notePanel.style.display === 'flex' ? 'none' : 'flex';
    if (notePanel.style.display === 'flex') noteInput.focus();
  };

  async function uploadPhoto(file) {
    const fileRef = storage.ref().child('noteImages/' + Date.now() + '_' + file.name);
    await fileRef.put(file);
    return fileRef.getDownloadURL();
  }

  addNoteBtn.onclick = async () => {
  const noteText = noteInput.innerHTML.trim();
  if (!noteText) return alert("Please enter a note.");
  const file = imageInput.files[0] || null;
  addNoteBtn.disabled = true;
  addNoteBtn.textContent = "Uploading...";

  try {
    let imageUrl = null;
    if (file) imageUrl = await uploadPhoto(file);
    await db.collection('notes').add({
      content: noteText,
      imageUrl: imageUrl || null,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    addMessage('bot', '‚úÖ Note added!', imageUrl);
    noteInput.innerHTML = ''; // üßº clear the rich text input
    imageInput.value = '';
    notePanel.style.display = 'none';
  } catch (e) {
    alert('Error: ' + e.message);
  } finally {
    addNoteBtn.disabled = false;
    addNoteBtn.textContent = "Add Note";
  }
};


  async function queryNotes(question) {
    const snapshot = await db.collection('notes').orderBy('createdAt', 'desc').get();
    return snapshot.docs
      .filter(doc => doc.data().content.toLowerCase().includes(question.toLowerCase()))
      .map(doc => ({ ...doc.data(), id: doc.id }));
  }

  function displayNotes(notes, query = '') {
  chat.innerHTML = '';

  if (notes.length === 0) {
    addMessage('bot', '‚ùå No matching notes found.');
    return;
  }

  const highlightText = (text, keyword) => {
    if (!keyword) return text;
    const regex = new RegExp(`(${keyword})`, 'gi');
    return text.replace(regex, `<mark style="background-color: #f8bbd0; color: black;">$1</mark>`);
  };

  notes.forEach(({ content, imageUrl, id }, index) => {
    const div = document.createElement('div');
    div.className = 'message bot';
    if (index > 0) div.style.borderTop = '1px solid rgba(255, 255, 255, 0.1)';

    const noteText = document.createElement('div');
    noteText.className = 'editableNote';
    noteText.contentEditable = false;
    noteText.innerHTML = highlightText(content, query); // highlight here
    div.appendChild(noteText);

    if (imageUrl) {
      const img = document.createElement('img');
      img.src = imageUrl;
      div.appendChild(img);
    }

    const btns = document.createElement('div');
    const editBtn = document.createElement('button');
    editBtn.className = 'note-btn';
    editBtn.textContent = '‚úèÔ∏è';
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'note-btn';
    deleteBtn.textContent = 'üóëÔ∏è';
    btns.append(editBtn, deleteBtn);
    div.appendChild(btns);

    let editing = false;
    editBtn.onclick = () => {
      if (!editing) {
        editing = true;
        noteText.contentEditable = true;
        noteText.focus();
        editBtn.textContent = '‚úÖ';
      } else {
        const updated = noteText.innerHTML.trim();
        if (!updated) return alert("Cannot be empty");
        db.collection('notes').doc(id).update({ content: updated });
        noteText.contentEditable = false;
        editBtn.textContent = '‚úèÔ∏è';
        editing = false;
      }
    };

    deleteBtn.onclick = () => {
      if (confirm("Delete this note?")) {
        db.collection('notes').doc(id).delete();
        chat.removeChild(div);
      }
    };

    chat.appendChild(div);
  });
}


  inputArea.onsubmit = async (e) => {
    e.preventDefault();
    const question = userInput.value.trim();
    if (!question) return;
    addMessage('user', question);
    userInput.value = '';
    addMessage('bot', '‚è≥ Searching...');
    const results = await queryNotes(question);
    const lastBot = [...chat.querySelectorAll('.bot')].pop();
    if (lastBot && lastBot.textContent.includes('Searching')) chat.removeChild(lastBot);
    displayNotes(results, question);
  };

  // Emojis and formatting
  document.querySelectorAll('.emoji').forEach(btn => {
    btn.onclick = () => {
      navigator.clipboard.writeText(btn.dataset.emoji);
      btn.style.transform = 'scale(1.3)';
      setTimeout(() => (btn.style.transform = 'scale(1)'), 200);
    };
  });

  document.getElementById('boldBtn').onclick = () => {
    document.execCommand('bold');
  };

  document.getElementById('highlightBtn').onclick = () => {
  document.execCommand('foreColor', false, '#ffd54f'); // Yellow font color
};
document.getElementById('resetColorBtn').onclick = () => {
  document.execCommand('foreColor', false, 'white');
};


  addMessage('bot', 'üëã Welcome X! How can I help you today?');
</script>
</body>
</html>
