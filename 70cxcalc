<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exit Screening Criteria</title>

<style>
@font-face {
  font-family: 'Adelicia';
  src: url('AdeliciaRegular.ttf') format('truetype');
}

body, input, button, div, label, span {
  font-family: 'Tahoma', sans-serif;
}

body {
  background: linear-gradient(to bottom, #ebebeb, #f5ecf0);
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

main {
  max-width: 480px;
  width: 100%;
  padding: 1.2rem;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(20px);
  border-radius: 14px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.12);
}

h1 {
  font-family: 'Adelicia', cursive;
  text-align: center;
  margin: 0 0 1.5rem;
  font-size: 2.3rem;
  color: #000;
  text-shadow:
    -1px -1px 0 #f8c8dc,
     1px -1px 0 #d3c7ce,
    -1px  1px 0 #f7d9e1,
     1px  1px 0 #b8b5b9,
     0 0 12px rgba(255,255,255,0.9);
}

label { display: block; margin-top: 1rem; font-weight: 600; }

input[type="date"] {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 12px;
}

.ageDisplay {
  font-size: 12px;
  margin-top: 4px;
  color: #333;
  font-weight: bold;
}

.result {
  margin-top: 1.5rem;
  padding: 1rem;
  border-radius: 12px;
  font-size: 10px;
  text-align: center;
  font-weight: bold;
}

.yes { color: #1f8f3a; background: #d8f5df; }
.no { color: #b32626; background: #f5dada; }

#dynamicCriteria {
  display: none;
  margin-top: 1.2rem;
  padding: 1rem;
  border-radius: 12px;
  border: 1px solid #ddd;
  background: #ffffffb8;
  font-size: 14px;
  line-height: 1.5;
}

button {
  width: 100%;
  padding: 0.55rem;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s;
}

#copyDynamic {
  background: #d8e7f9;
  margin-top: 0.6rem;
}
#copyDynamic:hover { background: #bcd4ef; }
</style>
</head>
<body>

<main>
  <h1>Exit Screening Criteria</h1>

  <label>Date of Birth</label>
  <input type="date" id="dob">
  <div id="ageNow" class="ageDisplay"></div>

  <label>HPV NOT DETECTED Test Date (if applicable)</label>
  <input type="date" id="hpv">
  <div id="ageHPV" class="ageDisplay"></div>

  <label>1st Normal Cytology Test Date</label>
  <input type="date" id="test1">
  <div id="ageT1" class="ageDisplay"></div>

  <label>2nd Normal Cytology Test Date</label>
  <input type="date" id="test2">
  <div id="ageT2" class="ageDisplay"></div>

  <div id="result"></div>

  <!-- Dynamic criteria display -->
  <div id="dynamicCriteria"></div>
  <button id="copyDynamic" style="display:none;" onclick="copyCriteria()">Copy This Criteria</button>

</main>

<script>
function formatAge(dob, date) {
  const d1 = new Date(dob);
  const d2 = new Date(date);
  if (isNaN(d1) || isNaN(d2)) return "";
  const diffMs = d2 - d1;
  const ageYears = diffMs / (1000 * 60 * 60 * 24 * 365.25);
  const ageDays = diffMs / (1000 * 60 * 60 * 24);
  return `Age at this date: ${ageYears.toFixed(1)} years (${Math.floor(ageYears)} yrs, ${Math.floor(ageDays % 365)} days)`;
}

function getAge(dob, ref) {
  return (new Date(ref) - new Date(dob)) / (1000 * 60 * 60 * 24 * 365.25);
}

function copyCriteria() {
  navigator.clipboard.writeText(document.getElementById("dynamicCriteria").innerText);
}

function update() {
  const dob = dobInput.value;
  if (!dob) return;

  ageNow.innerText = `Current Age: ${getAge(dob, new Date()).toFixed(1)} years`;

  ageHPV.innerText = hpvInput.value ? formatAge(dob, hpvInput.value) : "";
  ageT1.innerText = test1.value ? formatAge(dob, test1.value) : "";
  ageT2.innerText = test2.value ? formatAge(dob, test2.value) : "";

  const hpv = hpvInput.value, t1 = test1.value, t2 = test2.value;
  const currentAge = getAge(dob, new Date());
  const dynamicBox = document.getElementById("dynamicCriteria");
  const copyBtn = document.getElementById("copyDynamic");

  dynamicBox.style.display = "none";
  copyBtn.style.display = "none";

  // Rule 2 (HPV after 65 or Age ≥ 69 + HPV)
  if (hpv && (getAge(dob, hpv) >= 65 || currentAge >= 69)) {
    result.innerHTML = `<div class="result yes">✅ HPV Not Detected after age 65 → Eligible to exit screening.</div>`;
    dynamicBox.innerText = `2) An HPV Not Detected result after age 65.`;
    dynamicBox.style.display = "block";
    copyBtn.style.display = "block";
    return;
  }

  // Rule 1 (Two cytology results)
  if (t1 && t2 && currentAge >= 65 && currentAge <= 90) {
    const age1 = getAge(dob, t1);
    const age2 = getAge(dob, t2);
    if (age1 >= 62 && age2 >= 62 && (age1 >= 65 || age2 >= 65)) {
      result.innerHTML = `<div class="result yes">✅ Cytology criteria met → Eligible to exit screening.</div>`;
      dynamicBox.innerText = `1) Two consecutive negative cytology results after age 62, with at least one taken after age 65.`;
      dynamicBox.style.display = "block";
      copyBtn.style.display = "block";
      return;
    }
  }

  result.innerHTML = `<div class="result no">❗ Exit criteria not currently met.</div>`;
}
  
const dobInput = document.getElementById("dob");
const hpvInput = document.getElementById("hpv");
const test1 = document.getElementById("test1");
const test2 = document.getElementById("test2");

dobInput.onchange = update;
hpvInput.onchange = update;
test1.onchange = update;
test2.onchange = update;
</script>

</body>
</html>
