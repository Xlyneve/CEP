<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exit Screening Criteria</title>
<style>
@font-face {
  font-family: 'Adelicia';
  src: url('AdeliciaRegular.ttf') format('truetype');
}
@font-face {
  font-family: 'Simplicity';
  src: url('Simplicity.ttf') format('truetype');
}

body {
  font-family: 'Simplicity', sans-serif;
  background: linear-gradient(to bottom, #ebebeb, #f5ecf0);
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

main {
  max-width: 480px;
  width: 100%;
  padding: 1.2rem;
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(20px);
  border-radius: 14px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.12);
}

h1 {
  font-family: 'Adelicia', cursive;
  text-align: center;
  margin: 0 0 1.5rem;
  font-size: 2.3rem;
  color: #000;
  text-shadow:
    -1px -1px 0 #f8c8dc,
     1px -1px 0 #d3c7ce,
    -1px  1px 0 #f7d9e1,
     1px  1px 0 #b8b5b9,
     0 0 12px rgba(255,255,255,0.9);
}

label { display: block; margin-top: 1rem; font-weight: 600; }

input[type="date"] {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

.result {
  margin-top: 1.5rem;
  padding: 1rem;
  border-radius: 12px;
  font-size: 1.2rem;
  text-align: center;
  font-weight: bold;
}

.yes { color: #1f8f3a; background: #d8f5df; }
.no { color: #b32626; background: #f5dada; }

#ageInfo {
  margin-top: 0.8rem;
  font-size: 1rem;
  font-weight: bold;
  color: #444;
}

#exitCriteriaBox {
  margin-top: 1.7rem;
  background: #ffffffc7;
  padding: 1rem;
  border-radius: 12px;
  font-size: 0.95rem;
  line-height: 1.5;
  border: 1px solid #ddd;
}

#copyBtn {
  margin-top: 0.7rem;
  width: 100%;
  padding: 0.55rem;
  border-radius: 10px;
  border: none;
  background: #e7c6d9;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s;
}
#copyBtn:hover { background: #d7b0c8; }
</style>
</head>
<body>

<main>
  <h1>Exit Screening Criteria</h1>

  <label>Date of Birth</label>
  <input type="date" id="dob">

  <div id="ageInfo"></div>

  <label>HPV NOT DETECTED Test Date (if applicable)</label>
  <input type="date" id="hpv">

  <label>1st Normal Cytology Test Date</label>
  <input type="date" id="test1">

  <label>2nd Normal Cytology Test Date</label>
  <input type="date" id="test2">

  <div id="result"></div>

  <!-- Copyable Guidelines -->
  <div id="exitCriteriaBox">
Participants aged 69+:
• A single HPV Not Detected result is enough to safely discharge from NCSP.

Participants aged 65–74:
Do not require an exit test if either of the following exit criteria have been met:

1) Two consecutive negative cytology results after age 62,
   with at least one taken after age 65.

OR

2) An HPV Not Detected result after age 65.
  </div>

  <button id="copyBtn" onclick="navigator.clipboard.writeText(document.getElementById('exitCriteriaBox').innerText)">
    Copy Exit Criteria
  </button>
</main>

<script>
function getAge(dob, ref) {
  const d1 = new Date(dob);
  const d2 = new Date(ref);
  return (d2 - d1) / (1000 * 60 * 60 * 24 * 365.25);
}

function update() {
  const dob = dobInput.value;
  const hpv = hpvInput.value;
  const t1 = test1.value;
  const t2 = test2.value;

  if (!dob) return;

  const today = new Date();
  const currentAge = getAge(dob, today);
  ageInfo.innerHTML = `Current Age: ${currentAge.toFixed(1)} years`;

  // Rule 1: Age ≥ 69 + one HPV NOT DETECTED at any time
  if (hpv && currentAge >= 69) {
    result.innerHTML = `<div class="result yes">✅ Age ≥ 69 + HPV Not Detected → Safe to exit screening.</div>`;
    return;
  }

  // Rule 2: Age 65–74 + HPV Not Detected after age 65
  if (hpv && currentAge >= 65 && currentAge <= 74) {
    const ageHPV = getAge(dob, hpv);
    if (ageHPV >= 65) {
      result.innerHTML = `<div class="result yes">✅ HPV Not Detected after age 65 → Eligible to exit screening.</div>`;
      return;
    }
  }

  // Rule 3: Age 65–74 + Two negative cytology after age 62, and one after age 65
  if (t1 && t2 && currentAge >= 65 && currentAge <= 74) {
    const age1 = getAge(dob, t1);
    const age2 = getAge(dob, t2);

    if (age1 >= 62 && age2 >= 62 && (age1 >= 65 || age2 >= 65)) {
      result.innerHTML = `<div class="result yes">✅ Two negative cytology results (one after age 65) → Eligible to exit screening.</div>`;
      return;
    }
  }

  result.innerHTML = `<div class="result no">❗ Exit criteria not currently met.</div>`;
}

const dobInput = document.getElementById("dob");
const hpvInput = document.getElementById("hpv");
const test1 = document.getElementById("test1");
const test2 = document.getElementById("test2");
const result = document.getElementById("result");
const ageInfo = document.getElementById("ageInfo");

dobInput.onchange = update;
hpvInput.onchange = update;
test1.onchange = update;
test2.onchange = update;
</script>

</body>
</html>
