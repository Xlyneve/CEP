<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>URGENT CARE</title>

  <!-- STYLES -->
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Tahoma', sans-serif;
  overflow-x: hidden;
  position: relative;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('2b.png') no-repeat center center fixed;
  background-size: cover;
  filter: blur(10px) brightness(0.9);
  z-index: -1;
}

@font-face {
  font-family: 'fors';
  src: url('fors.ttf') format('truetype');
}
@font-face {
  font-family: 'hellohon';
  src: url('hellohon.otf') format('opentype');
}

h1 {
  position: relative;
  top: 10px;
  text-align: center;
  color: black;
  font-family: 'hellohon', sans-serif;
  font-weight: normal;
  font-size: 6rem;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 100%;
  margin: 0 auto;
  text-align: center;
  padding: 0.5rem;
  position: relative;
  top: -30px;
}

/* Default button style */
button {
  margin-top: 10px;
  padding: 0.6rem 1.2rem;
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.1);
  color: black;
  font-family: 'fors', sans-serif;
  font-weight: 300;
  cursor: pointer;
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), inset 0 4px 10px rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
}

/* Hover effect for regular buttons only */
button:not(.plus-text):hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
  color: #000;
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15), inset 0 4px 12px rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
}

/* + icon button style */
.plus-text {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 2rem;
  font-weight: bold;
  color: black;
  cursor: pointer;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  outline: none;
  transform: none;
  z-index: 1000;
  user-select: none;
  pointer-events: auto;
}

/* Ensure + icon stays transparent on hover/focus/active */
.plus-text:hover,
.plus-text:focus,
.plus-text:active {
  background: transparent !important;
  box-shadow: none !important;
  color: black !important;
  transform: none !important;
}

/* Notes grid */
#notes {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-top: 2rem;
}

.note-card {
  background: rgba(234, 224, 218, 0.15);
  border-radius: 12px;
  padding: 1rem;
  backdrop-filter: blur(15px);
  text-align: left;
  color: black;
  position: relative;
}

.note-image {
  max-width: 100%;
  max-height: 200px;
  cursor: zoom-in;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}
.note-text {
  font-size: 12px; /* adjust as needed */
  font-family: 'Tahoma', sans-serif; /* optional */
  line-height: 1.4;
}

.btn-container {
  display: none;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.format-toolbar {
  display: flex;
  gap: 0.5rem;
  margin: 0.5rem 0;
}

.format-toolbar button {
  padding: 0.3rem 0.6rem;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,0.2);
  cursor: pointer;
}

#search-container {
  position: absolute;
  top: 15px;
  right: 20px;
}

#search {
  width: 200px;
  padding: 0.4rem;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  color: black;
  outline: none;
}

.home-btn {
  position: absolute;
  top: 15px;
  left: 20px;
  background: rgba(255, 255, 255, 0.2);
  padding: 0.4rem 0.8rem;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  text-decoration: none;
  color: black;
  font-weight: bold;
  backdrop-filter: blur(8px);
  z-index: 1000;
}
/* IMAGE ZOOM OVERLAY */
#image-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: zoom-out;
}

#image-overlay img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 8px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  transition: transform 0.3s ease;
}

</style>

</head>
<body>
 <a href="home.html"><button class="home-btn">Home</button></a>
<h1 class="page-title">Urgent Care</h1>

<div id="search-container">
  <input type="text" id="search" placeholder="Search notes..." oninput="searchNotes()"/>
  <!-- use a button element so clicks work reliably -->
  <button id="add-note-btn" class="plus-text" aria-label="Add note">+</button>
</div>

<div class="container">
  <!-- Hidden input area (shows when + clicked) -->
  <div id="note-input-wrapper" style="display:none; margin-top:0.8rem;">
    <!-- toolbar: hidden until editing starts -->
    <div id="format-toolbar" class="format-toolbar" style="display:none;">
      <button type="button" data-cmd="bold"><b>B</b></button>
      <button type="button" data-cmd="underline"><u>U</u></button>
      <button type="button" data-cmd="highlight">H</button>
    </div>

    <!-- contenteditable preserves bold/underline/mark HTML -->
   <div id="note" class="note-input" contenteditable="true" data-placeholder="Write your note here..."
     style="display:block; min-height:72px; max-width:500px; width:90%; margin:60px auto 0 auto; border-radius:8px; padding:8px; background:rgba(255,255,255,0.03); text-align:left;"></div>


    <input type="file" id="image" accept="image/*" style="margin-top:8px;" />

    <div style="margin-top:8px;">
      <button id="save-note-btn" style="display:inline-block;">Save Note</button>
      <button id="cancel-note-btn" type="button">Cancel</button>
    </div>
  </div>

  <div id="notes"></div>
</div>

<div id="image-overlay" onclick="unzoomImage()"></div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgYsVQNEOyQa41NkXXT2VuKClqXAxfG1Q",
  authDomain: "cepx-f9d2a.firebaseapp.com",
  projectId: "cepx-f9d2a",
  storageBucket: "cepx-f9d2a.appspot.com",
  messagingSenderId: "840696526325",
  appId: "1:840696526325:web:b9bcb4669fbfad066a1cbc"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const urgentCareCollection = collection(db, "urgentCareNotes");

// Save a note
async function saveNote() {
  const noteInput = document.getElementById("note");
  const noteText = noteInput.innerHTML.trim();
  const imageFile = document.getElementById("image").files[0];
  if (!noteText && !imageFile) return;

  if (imageFile) {
    const reader = new FileReader();
    reader.onloadend = async () => {
      await addDoc(urgentCareCollection, { note: noteText, image: reader.result });
      resetForm();
      loadNotes();
    };
    reader.readAsDataURL(imageFile);
  } else {
    await addDoc(urgentCareCollection, { note: noteText, image: "" });
    resetForm();
    loadNotes();
  }
}

// Reset input form
function resetForm() {
  const noteInput = document.getElementById("note");
  const imageInput = document.getElementById("image");
  const saveBtn = document.getElementById("save-note-btn");
  const cancelBtn = document.getElementById("cancel-note-btn");
  const addBtn = document.getElementById("add-note-btn");

  noteInput.innerHTML = "";
  imageInput.value = "";
  noteInput.parentElement.style.display = "none";
  saveBtn.style.display = "none";
  cancelBtn.style.display = "none";
  addBtn.style.display = "inline-block";
}

// Load notes from Firestore
async function loadNotes(filter = "") {
  const notesContainer = document.getElementById("notes");
  notesContainer.innerHTML = "";
  const querySnapshot = await getDocs(urgentCareCollection);
  const searchWords = filter.toLowerCase().trim().split(/\s+/).filter(Boolean);

  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    const noteText = data.note || "";

    if (searchWords.length > 0 && !searchWords.every(w => noteText.toLowerCase().includes(w))) return;

    const card = document.createElement("div");
    card.className = "note-card";

    // Image
    if (data.image) {
      const img = document.createElement("img");
      img.src = data.image;
      img.className = "note-image";
      img.style.cursor = "zoom-in";
      card.appendChild(img);

      // Click toggles zoom
      img.addEventListener("click", () => zoomImage(img.src));
    }

    // Note text
    const noteDiv = document.createElement("div");
    noteDiv.className = "note-text";
    noteDiv.innerHTML = noteText;
    noteDiv.setAttribute("contenteditable", "false");
    card.appendChild(noteDiv);

    // Buttons
    const btnContainer = document.createElement("div");
    btnContainer.className = "btn-container";

    // Edit
    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.onclick = () => {
      noteDiv.setAttribute("contenteditable", "true");
      noteDiv.focus();

      const toolbar = document.createElement("div");
      toolbar.className = "format-toolbar";
      ["bold","underline","highlight"].forEach(cmd => {
        const btn = document.createElement("button");
        btn.textContent = cmd === "highlight" ? "H" : cmd.charAt(0).toUpperCase();
        btn.onclick = () => cmd === "highlight" ? document.execCommand("backColor", false, "#f9e1a8") : document.execCommand(cmd,false,null);
        toolbar.appendChild(btn);
      });
      card.insertBefore(toolbar, noteDiv);

      btnContainer.innerHTML = "";
      const saveBtn = document.createElement("button");
      saveBtn.textContent = "Save";
      saveBtn.onclick = async () => {
        await updateDoc(doc(urgentCareCollection, docSnap.id), { note: noteDiv.innerHTML });
        noteDiv.setAttribute("contenteditable","false");
        toolbar.remove();
        btnContainer.style.display = "none";
        loadNotes(filter);
      };

      const cancelBtn = document.createElement("button");
      cancelBtn.textContent = "Cancel";
      cancelBtn.onclick = () => {
        noteDiv.setAttribute("contenteditable","false");
        toolbar.remove();
        btnContainer.style.display = "none";
        loadNotes(filter);
      };

      btnContainer.appendChild(saveBtn);
      btnContainer.appendChild(cancelBtn);
      btnContainer.style.display = "flex";
    };

    // Delete
    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.onclick = async () => {
      await deleteDoc(doc(urgentCareCollection, docSnap.id));
      loadNotes(filter);
    };

    btnContainer.appendChild(editBtn);
    btnContainer.appendChild(delBtn);
    card.appendChild(btnContainer);

    // Long press
    let pressTimer;
    const showButtons = () => btnContainer.style.display = "flex";
    const clearPress = () => clearTimeout(pressTimer);
    card.addEventListener("mousedown", () => pressTimer = setTimeout(showButtons,600));
    card.addEventListener("mouseup", clearPress);
    card.addEventListener("mouseleave", clearPress);
    card.addEventListener("touchstart", () => pressTimer = setTimeout(showButtons,600));
    card.addEventListener("touchend", clearPress);

    notesContainer.appendChild(card);
  });
}

// Toggle image zoom
function zoomImage(src) {
  const overlay = document.getElementById("image-overlay");
  const currentImg = overlay.querySelector("img");

  if (currentImg && currentImg.src === src) {
    // same image clicked, hide overlay
    unzoomImage();
  } else {
    overlay.innerHTML = `<img src="${src}">`;
    overlay.style.display = "flex";
    overlay.querySelector("img").onclick = () => unzoomImage();
  }
}

// Hide overlay
function unzoomImage() {
  const overlay = document.getElementById("image-overlay");
  overlay.style.display = "none";
  overlay.innerHTML = "";
}

// Debounce helper
function debounce(fn, delay) {
  let timeout;
  return (...args) => {
    clearTimeout(timeout);
    timeout = setTimeout(() => fn(...args), delay);
  };
}

window.searchNotes = debounce(() => {
  const searchVal = document.getElementById("search").value;
  loadNotes(searchVal);
},300);

window.saveNote = saveNote;
window.loadNotes = loadNotes;

window.onload = () => {
  loadNotes();

  const addBtn = document.getElementById("add-note-btn");
  const saveBtn = document.getElementById("save-note-btn");
  const cancelBtn = document.getElementById("cancel-note-btn");
  const noteInput = document.getElementById("note");

  addBtn.addEventListener("click", () => {
    noteInput.parentElement.style.display = "block";
    saveBtn.style.display = "inline-block";
    cancelBtn.style.display = "inline-block";
    addBtn.style.display = "none";
    noteInput.focus();
  });

  saveBtn.addEventListener("click", saveNote);
  cancelBtn.addEventListener("click", resetForm);
};
</script>

</body>
</html>
