<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test Upload Note</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    img { max-width: 200px; border-radius: 8px; cursor: pointer; }
    .note { margin-bottom: 20px; }
    #modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
    #modal img { max-width: 90%; max-height: 90%; }
  </style>
</head>
<body>
  <h2>Upload Note</h2>
  <input type="text" id="title" placeholder="Enter title"><br><br>
  <input type="file" id="fileInput"><br><br>
  <button onclick="saveNote()">Save</button>
  <p id="status"></p>
  <hr>
  <div id="notes"></div>

  <div id="modal" onclick="this.style.display='none'">
    <img id="modalImg" src="">
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    async function saveNote() {
      const title = document.getElementById("title").value;
      const file = document.getElementById("fileInput").files[0];
      const status = document.getElementById("status");
      if (!title || !file) return alert("Add title and select image.");

      try {
        status.innerText = "Uploading...";
        const storageRef = storage.ref().child("test/" + Date.now() + "_" + file.name);
        const snapshot = await storageRef.put(file);
        const imageUrl = await snapshot.ref.getDownloadURL();

        await db.collection("testNotes").add({ title, imageUrl, created: firebase.firestore.FieldValue.serverTimestamp() });

        status.innerText = "Note saved!";
        document.getElementById("title").value = "";
        document.getElementById("fileInput").value = "";
        loadNotes();
      } catch (error) {
        console.error("Error saving note:", error);
        status.innerText = "Error saving note!";
      }
    }

    async function loadNotes() {
      const container = document.getElementById("notes");
      container.innerHTML = "";
      const snapshot = await db.collection("testNotes").orderBy("created", "desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "note";
        div.innerHTML = `<strong>${data.title}</strong><br><img src="${data.imageUrl}" onclick="zoomImage('${data.imageUrl}')">`;
        container.appendChild(div);
      });
    }

    function zoomImage(url) {
      document.getElementById("modalImg").src = url;
      document.getElementById("modal").style.display = "flex";
    }

    window.onload = loadNotes;
  </script>
</body>
</html>
