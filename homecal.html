<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendar and To-Do Page</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, addDoc
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAgYsVQNEOyQa41NkXXT2VuKClqXAxfG1Q",
      authDomain: "cepx-f9d2a.firebaseapp.com",
      projectId: "cepx-f9d2a",
      storageBucket: "cepx-f9d2a.firebasestorage.app",
      messagingSenderId: "840696526325",
      appId: "1:840696526325:web:b9bcb4669fbfad066a1cbc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", () => {
      const calendarEl = document.getElementById('calendar');
      const todoListEl = document.getElementById('todoList');
      const todoInput = document.getElementById('newTodo');
      const monthLabel = document.getElementById('monthLabel');
      const dayHeaders = document.getElementById('dayHeaders');

      let currentDate = new Date();

      function getMonthName(monthIndex) {
        return new Date(2000, monthIndex, 1).toLocaleString('default', { month: 'long' });
      }

      function getDaysInMonth(month, year) {
        return new Date(year, month + 1, 0).getDate();
      }

      function getDayName(year, month, day) {
        return new Date(year, month, day).toLocaleDateString('en-US', { weekday: 'short' });
      }

      async function loadCalendar() {
        calendarEl.innerHTML = '';
        const month = currentDate.getMonth();
        const year = currentDate.getFullYear();
        const daysInMonth = getDaysInMonth(month, year);
        monthLabel.textContent = `${getMonthName(month)} ${year}`;

        const docRef = doc(db, 'calendar', `${year}-${month + 1}`);
        let notes = {};
        try {
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            notes = docSnap.data();
          }
        } catch (error) {
          console.error("Error loading calendar:", error);
        }

        const firstDayOfMonth = new Date(year, month, 1).getDay();
        for (let i = 0; i < firstDayOfMonth; i++) {
          const empty = document.createElement('div');
          empty.className = 'day empty';
          calendarEl.appendChild(empty);
        }

        for (let i = 1; i <= daysInMonth; i++) {
          const note = notes[i] || "";
          const day = document.createElement('div');
          day.className = 'day';
          const dayName = getDayName(year, month, i);
          day.innerHTML = `<div class="date-number">${dayName} ${i}</div><textarea placeholder=" ">${note}</textarea>`;
          const textarea = day.querySelector('textarea');
          textarea.addEventListener('input', () => saveCalendar(year, month + 1, i.toString(), textarea.value));
          calendarEl.appendChild(day);
        }
      }

      async function saveCalendar(year, month, day, note) {
        const ref = doc(db, 'calendar', `${year}-${month}`);
        try {
          await updateDoc(ref, { [day]: note });
        } catch {
          await setDoc(ref, { [day]: note }, { merge: true });
        }
      }

      function changeMonth(offset) {
        currentDate.setMonth(currentDate.getMonth() + offset);
        loadCalendar();
      }

      async function addTodo() {
        const value = todoInput.value.trim();
        if (value) {
          await addDoc(collection(db, 'todos'), { text: value, done: false });
          todoInput.value = '';
        }
      }

      function renderTodoItem(id, text, done) {
        const item = document.createElement('div');
        item.className = 'todo-item';
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = done;
        checkbox.addEventListener('change', () => updateDoc(doc(db, 'todos', id), { done: checkbox.checked }));
        item.appendChild(checkbox);
        const span = document.createElement('span');
        span.textContent = text;
        item.appendChild(span);
        todoListEl.appendChild(item);
      }

      function loadTodos() {
        const todosRef = collection(db, 'todos');
        onSnapshot(todosRef, (snapshot) => {
          todoListEl.innerHTML = '';
          snapshot.forEach((doc) => {
            const data = doc.data();
            renderTodoItem(doc.id, data.text, data.done);
          });
        });
      }

      window.addTodo = addTodo;
      window.changeMonth = changeMonth;
      loadCalendar();
      loadTodos();
    });
  </script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      font-size: 8pt;
      background-color: #F8EDEB;
      display: flex;
      height: 100vh;
    }
    .calendar-container {
      width: 65%;
      background-color: #D8E2DC;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      position: relative;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .calendar-header button {
      padding: 5px 10px;
      font-size: 16px;
      background-color: #FEC5BB;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .home-button {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      background-color: #DED6CE;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 10pt;
    }
    .day-headers {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 5px;
    }
    .day {
      background-color: #F5EBED;
      border-radius: 8px;
      padding: 10px;
      min-height: 100px;
      position: relative;
    }
    .day.empty {
      background-color: transparent;
      border: none;
    }
    .day textarea {
      width: 100%;
      height: 60px;
      resize: none;
      background-color: #ffffffa0;
      border: none;
      padding: 5px;
      margin-top: 5px;
      font-family: Arial;
      font-size: 8pt;
    }
    .day .date-number {
      font-weight: bold;
    }
    .todo-container {
      width: 35%;
      background-color: #FAE1DD;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .todo-title {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .todo-list {
      background-color: #DED6CE;
      padding: 15px;
      border-radius: 8px;
    }
    .todo-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .todo-item input[type="checkbox"] {
      margin-right: 10px;
    }
    .add-todo {
      display: flex;
      margin-top: 10px;
    }
    .add-todo input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px 0 0 4px;
    }
    .add-todo button {
      padding: 8px;
      border: none;
      background-color: #FEC5BB;
      cursor: pointer;
      border-radius: 0 4px 4px 0;
    }
  </style>
</head>
<body>
  <div class="calendar-container">
    <button class="home-button" onclick="location.href='index.html'">Home</button>
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">◀</button>
      <h2 id="monthLabel">Monthly Calendar</h2>
      <button onclick="changeMonth(1)">▶</button>
    </div>
    <div class="day-headers" id="dayHeaders">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>
  <div class="todo-container">
    <div class="todo-title">To-Do List</div>
    <div class="todo-list" id="todoList"></div>
    <div class="add-todo">
      <input type="text" id="newTodo" placeholder="Add new task..." />
      <button onclick="addTodo()">Add</button>
    </div>
  </div>
</body>
</html>
